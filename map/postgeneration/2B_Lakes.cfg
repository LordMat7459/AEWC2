## Lakes

#define WORLD_CONQUEST_TEK_MAP_POSTGENERATION_2B
	[event]
		name=prestart
		{WORLD_CONQUEST_TEK_MAP_CONSTRUCTOR_LAKES}
		{WORLD_CONQUEST_TEK_MAP_NOISE_CLASSIC Gs^Fp}
		{WORLD_CONQUEST_TEK_ENEMY_ARMY_EVENT}
		{WORLD_CONQUEST_TEK_MAP_REPAINT_2B}
		{WORLD_CONQUEST_TEK_BONUS_POINTS}
		{WCT_NOISE_SNOW_TO Gd,Wwf,Rb}
	[/event]
#enddef

#define WORLD_CONQUEST_TEK_MAP_REPAINT_2B
	[wc2_benchmark]
	name="wc2 repaint"
	## Add snow and ice
	{RANDOM 0..1}
	[if]
		{VARIABLE_CONDITIONAL random equals 0}
		[then]
			[store_locations]
				terrain=!,Ss,D*^*,Hd,W*^*,Mm^Xm,Xu,Mv,Q*^*,U*^*
				[and]
					terrain=M*^*
					radius=2
				[/and]
				variable=terrain_to_change
			[/store_locations]
			## base amount in map surface
			[store_map_dimensions]
				variable=map_data.dim
			[/store_map_dimensions]
			{VARIABLE map_data.surface "$($map_data.dim.height*$map_data.dim.width)"}
			{RANDOM "$($map_data.surface/675)".."$($map_data.surface/330)"}
			{WCT_STORM $random}
		[/then]
	[/if]
	{WCT_EXPAND_SNOW}
	{RANDOM 1..3}
	[terrain]
		terrain=Ai
		[and]
			terrain=Wwt,Wot
			[filter_adjacent_location]
				terrain=A*^*,Ms^*,Ha^*,Kha,Cha
				count=$random-6
			[/filter_adjacent_location]
		[/and]
	[/terrain]
	## randomize snowed forests
	[wc2_terrain]
		[change]
			[filter]
				terrain=*^Fpa
			[/filter]
			terrain="Aa^Fpa,Aa^Fda,Aa^Fma"
			layer=overlay
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=G*^Ft
			[/filter]
			terrain="Gg^Fms,Gg^Fds"
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=H*^Ft
			[/filter]
			terrain="Hh^Ft,Hh^Fms,Hh^Fds"
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=G*^Fp
			[/filter]
			terrain="Gg^Fms"
			fraction="2"
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=H*^Fp
			[/filter]
			terrain="Hh^Fms"
			fraction="6"
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=R*
				[not]
					terrain=C*^*,K*^*
					radius=4
				[/not]
			[/filter]
			terrain="Rb"
			fraction_rand="3..5"
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=*^Ve
			[/filter]
			terrain="Gg^Vc"
			fraction="2"
		[/change]
	[/wc2_terrain]
	[terrain]
		terrain=Gg^Vhs
		[and]
			terrain=G*^Vht
		[/and]
	[/terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=Hh^Vhh
			[/filter]
			terrain="Wwf^Vht"
			fraction="2"
		[/change]
	[/wc2_terrain]
	{RANDOM 0..19}
	[if]
		{VARIABLE_CONDITIONAL random greater_than 0}
		[then]
			[terrain]
				terrain=Gg
				layer=base
				[and]
					terrain=Gs^*
				[/and]
			[/terrain]
		[/then]
	[/if]
	{RANDOM 0..19}
	[if]
		{VARIABLE_CONDITIONAL random greater_than 0}
		[then]
			[wc2_terrain]
				[change]
					[filter]
						terrain=Gg
						[filter_adjacent_location]
							terrain=S*^*,Dd,Hd,A*^*,Ha*^*,Ms*^*
							count=0
						[/filter_adjacent_location]
						[and]
							terrain=*^Vh,*^Ve,*^Vc
							radius=2
						[/and]
						[and]
							terrain=W*^*
							radius=2
						[/and]
					[/filter]
					terrain="Gg^Gvs"
					fraction_rand="5..17"
				[/change]
			[/wc2_terrain]
		[/then]
		[else]
			[wc2_terrain]
				[change]
					[filter]
						terrain=Gg
						[filter_adjacent_location]
							terrain=D*^*
							count=0
						[/filter_adjacent_location]
						[and]
							terrain=*^Fet
							radius=3
						[/and]
						[and]
							terrain=Wwf
							radius=3
						[/and]
					[/filter]
					terrain="Gg^Efm"
					fraction_rand="3..5"
				[/change]
			[/wc2_terrain]
		[/else]
	[/if]
	{RANDOM 0..19}
	[if]
		{VARIABLE_CONDITIONAL random equals 0}
		[then]
			{WCT_MAP_DECORATIVE_DOCKS}
		[/then]
	[/if]
	{WCT_DIRT_BEACHS 9..11}
	## chance of different lakes water
	{RANDOM g,"","","","","","","","","","","","","","","","","",t}
	[terrain]
		terrain=Ww$random
		layer=base
		[and]
			terrain=Wwt^*
		[/and]
	[/terrain]
	[terrain]
		terrain=Wo$random
		[and]
			terrain=Wot
		[/and]
	[/terrain]
	## chance of frozen lakes
	{RANDOM 0..8}
	[if]
		{VARIABLE_CONDITIONAL random equals 0}
		[then]
			[wc2_terrain]
				[change]
					[filter]
						terrain=Ww,Wwg,Wo,Wog
						[filter_adjacent_location]
							terrain=*^Uf
							count=0
						[/filter_adjacent_location]
						[not]
							{WCT_MAP_FILTER_OCEANIC}
						[/not]
					[/filter]
					terrain="Ai"
					percentage="9"
					exact=no
				[/change]
			[/wc2_terrain]
			[terrain]
				terrain=Ms
				[and]
					terrain=M*
					[filter_adjacent_location]
						terrain=*^Uf
						count=0
					[/filter_adjacent_location]
					[and]
						terrain=Ai
						radius=2
					[/and]
				[/and]
			[/terrain]
			[terrain]
				terrain=Ha
				[and]
					terrain=Hh
					[filter_adjacent_location]
						terrain=*^Uf
						count=0
					[/filter_adjacent_location]
					[and]
						terrain=Ai
						radius=1
					[/and]
				[/and]
			[/terrain]
			[terrain]
				terrain=Ha^Fpa
				[and]
					terrain=Hh^F*
					[filter_adjacent_location]
						terrain=*^Uf
						count=0
					[/filter_adjacent_location]
					[and]
						terrain=Ai
						radius=1
					[/and]
				[/and]
			[/terrain]
		[/then]
	[/if]
	## chance of diferent forest based in map temperature
	[store_locations]
		terrain=A*^*,Ha*^*,Ms^*
		variable=terrain_to_change
	[/store_locations]
	{RANDOM 0..99}
	[if]
		{VARIABLE_CONDITIONAL random greater_than "$(2000*$terrain_to_change.length/$map_data.surface)"}
		[then]
			[terrain]
				terrain=*^Ftd
				layer=overlay
				[and]
					terrain=*^Ft
				[/and]
			[/terrain]
		[/then]
	[/if]
	[terrain]
		terrain=*^Fmf
		layer=overlay
		[and]
			terrain=*^Ft
		[/and]
	[/terrain]
	{CLEAR_VARIABLE map_data}
	[/wc2_benchmark]
#enddef

#define WORLD_CONQUEST_TEK_MAP_CONSTRUCTOR_LAKES
	{WCT_MAP_REDUCE_CASTLE_EXPANDING_RECRUIT Ce Re}
	## convert caves to water
	[terrain]
		terrain=Wwt^Vm
		[and]
			terrain=U*^V*
		[/and]
	[/terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=U*^*,Q*^*
			[/filter]
			terrain="Wwt,Wwt,Wwt,Wot"
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=Xu
			[/filter]
			terrain="Wwt,Wwt,Wwt,Wwt,Wwt,Wwt,Wot"
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=Mm^Xm
			[/filter]
			terrain="Wwt,Wwt,Wwt,Wwt,Wwt,Wwt,Wwt,Wwt,Wwt,Wot"
		[/change]
	[/wc2_terrain]
	## convert road to bridge if possible
	[terrain]
		terrain=Wwt^Bw|
		[and]
			terrain=R*
			[filter_adjacent_location]
				terrain=R*
				count=2
				adjacent=n,s
			[/filter_adjacent_location]
			[filter_adjacent_location]
				terrain=W*^*
				count=1-2
				adjacent=ne,se
			[/filter_adjacent_location]
			[filter_adjacent_location]
				terrain=W*^*
				count=1-2
				adjacent=nw,sw
			[/filter_adjacent_location]
		[/and]
	[/terrain]
	[terrain]
		terrain=Wwt^Bw/
		[and]
			terrain=R*
			[filter_adjacent_location]
				terrain=R*
				count=2
				adjacent=ne,sw
			[/filter_adjacent_location]
			[filter_adjacent_location]
				terrain=W*^*
				count=1-2
				adjacent=n,nw
			[/filter_adjacent_location]
			[filter_adjacent_location]
				terrain=W*^*
				count=1-2
				adjacent=s,se
			[/filter_adjacent_location]
		[/and]
	[/terrain]
	[terrain]
		terrain=Wwt^Bw\
		[and]
			terrain=R*
			[filter_adjacent_location]
				terrain=R*
				count=2
				adjacent=nw,se
			[/filter_adjacent_location]
			[filter_adjacent_location]
				terrain=W*^*
				count=1-2
				adjacent=n,ne
			[/filter_adjacent_location]
			[filter_adjacent_location]
				terrain=W*^*
				count=1-2
				adjacent=s,sw
			[/filter_adjacent_location]
		[/and]
	[/terrain]
	## expand lakes with fords
	[wc2_terrain]
		[change]
			[filter]
				[not]
					terrain=W*^*,R*^*,*^V*,K*^*,C*^*,S*,D*^*
				[/not]
				[filter_adjacent_location]
					terrain=Wwt^*,Wot,Wwf
				[/filter_adjacent_location]
			[/filter]
			terrain="Wwf"
			fraction="9"
		[/change]
	[/wc2_terrain]
	[wc2_terrain]
		[change]
			[filter]
				terrain=G*
				[filter_adjacent_location]
					terrain=Wwt^*,Wot,Wwf
				[/filter_adjacent_location]
				[filter_adjacent_location]
					terrain=M*^*
				[/filter_adjacent_location]
			[/filter]
			terrain="Wwf"
			fraction="2"
		[/change]
	[/wc2_terrain]
	## add mushrooms
	[wc2_terrain]
		[change]
			[filter]
				[not]
					terrain=W*^*,R*^*,*^V*,K*^*,C*^*,S*,D*^*,G*^*
				[/not]
				[filter_adjacent_location]
					terrain=Wwt^*,Wot,Wwf
				[/filter_adjacent_location]
				[filter_adjacent_location]
					terrain=A*^*,Ha^*,Ms^*
					count=0
				[/filter_adjacent_location]
			[/filter]
			terrain="Gg^Uf"
			fraction_rand="11..13"
		[/change]
	[/wc2_terrain]

	[store_map_dimensions]
		variable=map_data.dim
	[/store_map_dimensions]
	{VARIABLE map_data.surface "$($map_data.dim.height*$map_data.dim.width)"}
	{RANDOM "$($map_data.surface/675)".."$($map_data.surface/285)"}
	[wc2_terrain]
		[change]
			[filter]
				terrain=Hh^F*,Hh
				[filter_adjacent_location]
					terrain=A*^*,Ha^*,Ms^*
					count=0
				[/filter_adjacent_location]
			[/filter]
			terrain=Hh^Uf
			nlocs=$random
		[/change]
	[/wc2_terrain]
#enddef
